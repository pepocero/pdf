<?php
// Configuraci√≥n PHP
session_start();
$maxFileSize = 50 * 1024 * 1024; // 50MB
$allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/gif'];

// Crear directorios si no existen
if (!file_exists('uploads')) {
    mkdir('uploads', 0777, true);
}
if (!file_exists('saved_files')) {
    mkdir('saved_files', 0777, true);
}

// Informaci√≥n del servidor
$serverInfo = [
    'maxFileSize' => ini_get('upload_max_filesize'),
    'memoryLimit' => ini_get('memory_limit'),
    'postMaxSize' => ini_get('post_max_size'),
    'phpVersion' => phpversion()
];
?>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor PDF Avanzado</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÑ</text></svg>">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js" onerror="this.onerror=null; this.src='https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js'"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar con herramientas -->
        <div class="toolbar">
            <!-- Secci√≥n de Selecci√≥n -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <button id="selectTool" class="tool-btn active" data-tool="select" data-tooltip="Seleccionar">
                        <span class="icon">‚Üñ</span>
                    </button>
                    <button id="textSelectionTool" class="tool-btn" data-tool="textSelection" data-tooltip="Seleccionar Texto">
                        <span class="icon">üìù</span>
                    </button>
                    <button id="handTool" class="tool-btn" data-tool="hand" data-tooltip="Mano">
                        <span class="icon">‚úã</span>
                    </button>
                </div>
            </div>

            <!-- Secci√≥n de Editor de Texto -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <button id="textEditTool" class="tool-btn" data-tool="textEdit" data-tooltip="Editar Texto">
                        <span class="icon">‚úè</span>
                    </button>
                    <button id="textBoxTool" class="tool-btn" data-tool="textBox" data-tooltip="Cuadro de Texto">
                        <span class="icon">üìÑ</span>
                    </button>
                    <button id="textAddTool" class="tool-btn" data-tool="textAdd" data-tooltip="Agregar Texto">
                        <span class="icon">T+</span>
                    </button>
                </div>
            </div>

            <!-- Secci√≥n de Formato de Texto -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <input type="color" id="textColor" value="#000000" title="Color del texto">
                    <input type="range" id="fontSize" min="8" max="72" value="16" title="Tama√±o de fuente">
                    <select id="fontFamily">
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Georgia">Georgia</option>
                    </select>
                    <button id="boldBtn" class="tool-btn" title="Negrita" data-tooltip="Negrita">B</button>
                    <button id="italicBtn" class="tool-btn" title="Cursiva" data-tooltip="Cursiva">I</button>
                    <button id="underlineBtn" class="tool-btn" title="Subrayado" data-tooltip="Subrayado">U</button>
                    <button id="strikethroughBtn" class="tool-btn" title="Tachado" data-tooltip="Tachado">S</button>
                </div>
            </div>

            <!-- Secci√≥n de Dibujo -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <button id="drawTool" class="tool-btn" data-tool="draw" data-tooltip="Dibujar">
                        <span class="icon">‚úè</span>
                    </button>
                    <button id="lineTool" class="tool-btn" data-tool="line" data-tooltip="L√≠nea">
                        <span class="icon">üìè</span>
                    </button>
                    <button id="rectangleTool" class="tool-btn" data-tool="rectangle" data-tooltip="Rect√°ngulo">
                        <span class="icon">‚¨ú</span>
                    </button>
                    <button id="circleTool" class="tool-btn" data-tool="circle" data-tooltip="C√≠rculo">
                        <span class="icon">‚≠ï</span>
                    </button>
                    <button id="eraserTool" class="tool-btn" data-tool="eraser" data-tooltip="Borrador">
                        <span class="icon">üßΩ</span>
                    </button>
                    <input type="color" id="strokeColor" value="#000000" title="Color del trazo">
                    <input type="range" id="strokeWidth" min="1" max="20" value="2" title="Grosor del trazo">
                </div>
            </div>

            <!-- Secci√≥n de Objetos -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <button id="imageTool" class="tool-btn" data-tool="image" data-tooltip="Imagen">
                        <span class="icon">üñº</span>
                    </button>
                    <button id="highlightTool" class="tool-btn" data-tool="highlight" data-tooltip="Resaltar">
                        <span class="icon">üñç</span>
                    </button>
                    <button id="stampTool" class="tool-btn" data-tool="stamp" data-tooltip="Sello">
                        <span class="icon">üè∑</span>
                    </button>
                </div>
            </div>

            <!-- Secci√≥n de Edici√≥n -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <button id="copyBtn" class="tool-btn" title="Copiar" data-tooltip="Copiar">üìã</button>
                    <button id="cutBtn" class="tool-btn" title="Cortar" data-tooltip="Cortar">‚úÇ</button>
                    <button id="pasteBtn" class="tool-btn" title="Pegar" data-tooltip="Pegar">üìå</button>
                    <button id="deleteBtn" class="tool-btn" title="Eliminar" data-tooltip="Eliminar">üóë</button>
                    <button id="undoBtn" class="tool-btn" title="Deshacer" data-tooltip="Deshacer">‚Ü∂</button>
                    <button id="redoBtn" class="tool-btn" title="Rehacer" data-tooltip="Rehacer">‚Ü∑</button>
                </div>
            </div>

            <!-- Secci√≥n de Transformar -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <button id="rotateLeftBtn" class="tool-btn" title="Rotar izquierda" data-tooltip="Rotar izquierda">‚Ü∂</button>
                    <button id="rotateRightBtn" class="tool-btn" title="Rotar derecha" data-tooltip="Rotar derecha">‚Ü∑</button>
                    <button id="flipHorizontalBtn" class="tool-btn" title="Voltear horizontal" data-tooltip="Voltear horizontal">‚Üî</button>
                    <button id="flipVerticalBtn" class="tool-btn" title="Voltear vertical" data-tooltip="Voltear vertical">‚Üï</button>
                    <button id="bringToFrontBtn" class="tool-btn" title="Traer al frente" data-tooltip="Traer al frente">‚¨Ü</button>
                    <button id="sendToBackBtn" class="tool-btn" title="Enviar atr√°s" data-tooltip="Enviar atr√°s">‚¨á</button>
                </div>
            </div>

            <!-- Secci√≥n de P√°gina -->
            <div class="toolbar-section">
                <div class="tool-group">
                    <button id="prevPageBtn" class="tool-btn" title="P√°gina anterior" data-tooltip="P√°gina anterior">‚Äπ</button>
                    <span id="pageInfo" style="font-size: 0.7rem; color: #666; text-align: center;">1/1</span>
                    <button id="nextPageBtn" class="tool-btn" title="P√°gina siguiente" data-tooltip="P√°gina siguiente">‚Ä∫</button>
                    <button id="zoomOutBtn" class="tool-btn" title="Alejar" data-tooltip="Alejar">-</button>
                    <span id="zoomInfo" style="font-size: 0.7rem; color: #666; text-align: center;">100%</span>
                    <button id="zoomInBtn" class="tool-btn" title="Acercar" data-tooltip="Acercar">+</button>
                    <button id="resetZoomBtn" class="tool-btn" title="Restablecer zoom al 100%" data-tooltip="Restablecer zoom">‚åÇ</button>
                </div>
            </div>
        </div>

        <!-- Contenedor principal -->
        <div class="main-wrapper">
            <!-- Header -->
            <header class="app-header">
                <h1>Editor PDF Avanzado</h1>
                <div class="header-controls">
                    <input type="file" id="pdfInput" accept=".pdf" style="display: none;">
                    <button id="loadPdfBtn" class="btn btn-primary">Cargar PDF</button>
                    <button id="downloadPdfBtn" class="btn btn-secondary" disabled>Descargar</button>
                    <button id="serverInfoBtn" class="btn btn-info" title="Informaci√≥n del servidor">‚ÑπÔ∏è</button>
                </div>
            </header>

            <!-- Main Content -->
            <div class="main-content">
                <div class="pdf-viewer">
                    <div id="pdfContainer" class="pdf-pages-container">
                        <div id="loadingIndicator" class="loading" style="display: none;">
                            <div class="spinner"></div>
                            <p>Cargando PDF...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for images -->
    <input type="file" id="imageInput" accept="image/*" style="display: none;">

    <!-- Modal para informaci√≥n del servidor -->
    <div id="serverInfoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Informaci√≥n del Servidor</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="server-info">
                    <div class="info-item">
                        <strong>PHP Version:</strong> <?php echo $serverInfo['phpVersion']; ?>
                    </div>
                    <div class="info-item">
                        <strong>Tama√±o m√°ximo de archivo:</strong> <?php echo $serverInfo['maxFileSize']; ?>
                    </div>
                    <div class="info-item">
                        <strong>L√≠mite de memoria:</strong> <?php echo $serverInfo['memoryLimit']; ?>
                    </div>
                    <div class="info-item">
                        <strong>POST m√°ximo:</strong> <?php echo $serverInfo['postMaxSize']; ?>
                    </div>
                    <div class="info-item">
                        <strong>Directorio de uploads:</strong> <?php echo is_writable('uploads') ? '‚úÖ Escribible' : '‚ùå No escribible'; ?>
                    </div>
                    <div class="info-item">
                        <strong>Directorio de guardado:</strong> <?php echo is_writable('saved_files') ? '‚úÖ Escribible' : '‚ùå No escribible'; ?>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeServerInfoBtn" class="btn btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="js/pdf-editor-new.js"></script>
</body>
</html>
